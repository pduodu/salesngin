@model List<CartItem>

@if (Model != null && Model.Count > 0)
{
    var settings = await _dataService.GetSettings();
    string currency = settings.Currency;
    decimal? cartTotal = Model.Sum(x => x.TotalAmount);
    int i = 0;
    
    <div class="table-responsive mb-8">
        <table id="tblMiniCart" class="table table-row-dashed table-hover align-middle gs-0 gy-3 my-0">
            <thead>
                <tr>
                    <th class="min-w-175px"></th>
                    <th class="w-125px"></th>
                    <th class="w-60px"></th>
                    <th class=""></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    i++;
                    <tr data-kt-pos-element="item" data-kt-pos-item-price="0">
                        <td class="">
                            <div class="d-flex align-items-center px-2">
                                <img src="@Url.Content(item.ItemPhoto)" class="w-45px h-45px rounded-1 me-2" alt="">
                                <span
                                    class="fw-semibold text-gray-800 cursor-pointer text-hover-primary fs-6 me-1">@item.ItemName</span>
                            </div>
                        </td>

                        <td class="pe-0">
                            <div class="position-relative d-flex align-items-center border border-secondary rounded-2 px-1"
                                data-kt-dialer="true" data-kt-dialer-min="1" data-kt-dialer-max="@item.StoreQuantity"
                                data-kt-dialer-step="1" data-kt-dialer-decimals="0">

                                <a id="lnkDecrease_@i" href="javascript:void(0)"
                                    onclick="decreaseQuantityPartial(@item.ItemId);"
                                    class="btn btn-icon btn-sm btn-light-primary btn-icon-gray-400">
                                    <i class="ki-duotone ki-minus fs-2x"></i>
                                </a>
                                <input asp-for="@item.Quantity" type="number"
                                    onchange="updateProductQuantity(@item.ItemId, @item.StoreQuantity,this)"
                                    class="form-control border-0 text-center px-0 fs-5 fw-bold text-gray-800 w-65px"
                                    data-kt-dialer-control="input" placeholder="Quantity">
                                <a id="lnkAdd_@i" href="javascript:void(0)" onclick="addProductToCart(@item.ItemId);"
                                    class="btn btn-icon btn-sm btn-light-primary btn-icon-gray-400">
                                    <i class="ki-duotone ki-plus fs-2x"></i>
                                </a>
                            </div>
                        </td>
                        <td class="text-end">
                            <span class="fw-bold text-dark fs-5" data-kt-pos-element="item-total">@item.TotalAmount</span>
                        </td>
                        <td>
                            <a id="remove_@item.ItemId" href="javascript:void(0)" onclick="removeFromCartPartial(@item.ItemId);"
                                class="btn btn-light-danger ml-2" data-bs-toggle="tooltip" data-bs-placement="right"
                                title="Remove Item">
                                <i class="ki-duotone ki-trash fs-2">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                    <span class="path3"></span>
                                    <span class="path4"></span>
                                    <span class="path5"></span>
                                </i>
                            </a>
                        </td>
                    </tr>

                }
            </tbody>
            <!--end::Table body-->
        </table>
        <!--end::Table-->
    </div>
    <!--end::Table container-->
    <div class="separator separator-dotted border-primary my-5"></div>
    <!--begin::order summary-->
    <div class="d-flex flex-stack bg-light-primary rounded-1 p-6 mb-11">
        <div class="fs-4 fw-bold text-primary">
            <span class="d-block fs-1 lh-1 fw-bolder">Cart Total ( @currency ): </span>
        </div>
        <div class="fs-4 fw-bold text-primary text-end">
            <small>@currency</small>
            <span class="d-block fs-2qx lh-1 fw-bold"> @cartTotal</span>
        </div>
    </div>


    @* @await Html.PartialAsync("Order/_CartSummaryPartial", Model) *@
    <!--end::order summary-->
}
else
{
    <div class="alert bg-light-danger d-flex flex-column flex-sm-row p-5 mb-10 mt-10">
        <i class="ki-duotone ki-basket fs-3x text-danger me-4 mb-5 mb-sm-0">
            <i class="path1"></i>
            <i class="path2"></i>
            <i class="path3"></i>
            <i class="path4"></i>
        </i>
        <div class="d-flex flex-column pe-0 pe-sm-10">
            <h4 class="fw-semibold">Cart Empty!</h4>
            <span>Search and add items.</span>
        </div>
    </div>
}