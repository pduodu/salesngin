@*@attribute*@
@model DashboardViewModel
@inject IDataControllerService _dataService
@{
    ViewData["Title"] = "Dashboard";
    ViewData["MainMenu"] = "Dashboard";
    ViewData["Page"] = "Dashboard";

    var settings = await _dataService.GetSettings();
}
@*
<!-- Vector CSS -->
<link href="~/Dashboard/assets/plugins/vectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet" />
<!-- simplebar CSS-->
<link href="~/Dashboard/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
<!-- Bootstrap core CSS-->
<link href="~/Dashboard/assets/css/bootstrap.min.css" rel="stylesheet" />
<!-- animate CSS-->
<link href="~/Dashboard/assets/css/animate.css" rel="stylesheet" type="text/css" />
<!-- Icons CSS-->
<link href="~/Dashboard/assets/css/icons.css" rel="stylesheet" type="text/css" />
<!-- Custom Style-->
<link href="~/Dashboard/assets/css/app-style.css" rel="stylesheet" />
*@
<!--<div class="row mb-5">
<div class="col-md-3">

<div class="input-group mb-5 w-100">
<span class="input-group-text p-3 fs-3">
<i class="ki-duotone ki-abstract-37 fs-2x me-2 text-primary">
<span class="path1"></span>
<span class="path2"></span>
</i>
Year
</span>
<div class="overflow-hidden flex-grow-1">
<select asp-for="@@Model.ActiveYear" onchange="GetDashboard()" class="form-select rounded-start-0 border-start fs-3" data-control="select2" data-hide-search="false" data-placeholder="Select ..." data-allow-clear="true">
<option value="">Select ...</option>
@@foreach (int year in Model.ActiveYears)
{
<option value="@@year">@@year</option>
}
</select>
</div>
</div>
</div>
</div>-->
<!--Start Dashboard Content-->

<div class="card bg-transparent card-border-0 shadow-0 mx-auto mb-6">
    <div class="card-header pt-5">
        <div class="card-title">
            <h2 class="d-flex align-items-center">
                <span class="text-gray-600 fs-6 ms-1"></span>
            </h2>
        </div>
        <div class="card-toolbar">
            <div class="input-group mb-5 w-100 float-end">

                <form method="get" asp-controller="Account" asp-action="Index" class="w-100">
                    <div class="input-group w-100 float-end fs-6">

                        <div class="me-3">
                            <label for="monthSelect" class="visually-hidden">Month</label>
                            <select id="monthSelect" name="month" class="form-select form-select-lg types-select">
                                <option value="0">Month: All</option>
                                @foreach (var month in Model.ActiveMonths)
                                {
                                    <option value="@month.value" selected="@(Model.ActiveMonth == month.value ? "selected" : null)">@month.name</option>
                                }
                            </select>
                        </div>

                        <div class="me-3">
                            <label for="yearSelect" class="visually-hidden">Year</label>
                            <select id="yearSelect" name="year" class="form-select form-select-lg types-select">
                                <option value="0">Year: All</option>
                                @foreach (int year in Model.ActiveYears.Take(10))
                                {
                                    <option value="@year" selected="@(Model.ActiveYear == year ? "selected" : null)">@year</option>
                                }
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="ki-duotone ki-filter fs-2 me-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            Apply Filter
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<div class="row g-5 g-xl-8">
    <div class="col-xl-3">

        <!--begin::Statistics Widget 5-->
        <a asp-controller="Facility" asp-action="Requests" class="card bg-body hoverable card-xl-stretch mb-xl-8">
            <!--begin::Body-->
            <div class="card-body">
                <i class="ki-duotone ki-delivery-3 text-primary fs-2x ms-n1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                </i>
                <div class="text-gray-900 fw-bold fs-2 mb-2 mt-5">
                    Requests ( @Model.RequestsCount )
                </div>

                <div class="fw-semibold text-gray-600">
                    Items requested by staff
                </div>
            </div>
            <!--end::Body-->
        </a>
        <!--end::Statistics Widget 5-->

    </div>

    <div class="col-xl-3">

        <!--begin::Statistics Widget 5-->
        <a asp-controller="Facility" asp-action="Inventory" class="card bg-body hoverable card-xl-stretch mb-xl-8">
            <!--begin::Body-->
            <div class="card-body">
                <i class="ki-duotone ki-cheque text-gray-100 fs-2x ms-n1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span></i>
                <i class="ki-duotone ki-bank text-primary fs-2x ms-n1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                </i>

                <div class="text-gray-900 fw-bold fs-2 mb-2 mt-5">
                    Inventory
                </div>

                <div class="fw-semibold text-gray-600">
                    Items in the storeroom
                </div>
            </div>
            <!--end::Body-->
        </a>
        <!--end::Statistics Widget 5-->

    </div>
    @*
    <div class="col-xl-3">

        <!--begin::Statistics Widget 5-->
        <a href="#" class="card bg-body hoverable card-xl-stretch mb-xl-8">
            <!--begin::Body-->
            <div class="card-body">
                <i class="ki-duotone ki-briefcase text-white fs-2x ms-n1"><span class="path1"></span><span class="path2"></span></i>

                <div class="text-gray-900 fw-bold fs-2 mb-2 mt-5">
                    $50,000
                </div>

                <div class="fw-semibold text-gray-600">
                    Milestone Reached
                </div>
            </div>
            <!--end::Body-->
        </a>
        <!--end::Statistics Widget 5-->

    </div>

    <div class="col-xl-3">

        <!--begin::Statistics Widget 5-->
        <a href="#" class="card bg-body hoverable card-xl-stretch mb-5 mb-xl-8">
            <!--begin::Body-->
            <div class="card-body">
                <i class="ki-duotone ki-chart-pie-simple text-white fs-2x ms-n1">
                    <span class="path1"></span><span class="path2"></span></i>

                <div class="text-gray-900 fw-bold fs-2 mb-2 mt-5">
                    $50,000
                </div>

                <div class="fw-semibold text-gray-600">
                    Milestone Reached
                </div>
            </div>
            <!--end::Body-->
        </a>
        <!--end::Statistics Widget 5-->

    </div>
    *@

</div>

<div class="row g-5 g-xl-8">
    <!--begin::Col-->
    <div class="col-xl-6">

        <!--begin::Tables Widget 3-->
        <div class="card card-xl-stretch mb-xl-8">
            <!--begin::Header-->
            <div class="card-header border-0 py-5">
                <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold fs-3 mb-1">Stock Summary</span>

                    <span class="text-gray-700 mt-1 fw-semibold fs-7">Items running low on stock or out of stock</span>
                </h3>
                <div class="card-toolbar">
                    @*
                    <!--begin::Menu-->
                    <button type="button" class="btn btn-sm btn-icon btn-color-primary btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                        <i class="ki-duotone ki-category fs-6"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></i>
                    </button>

                    <!--begin::Menu 3-->
                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-3" data-kt-menu="true" style="">
                        <!--begin::Heading-->
                        <div class="menu-item px-3">
                            <div class="menu-content text-muted pb-2 px-3 fs-7 text-uppercase">
                                Payments
                            </div>
                        </div>
                        <!--end::Heading-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link px-3">
                                Create Invoice
                            </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link flex-stack px-3">
                                Create Payment

                                <span class="ms-2" data-bs-toggle="tooltip" aria-label="Specify a target name for future usage and reference" data-bs-original-title="Specify a target name for future usage and reference" data-kt-initialized="1">
                                    <i class="ki-duotone ki-information fs-6"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>
                                </span>
                            </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <a href="#" class="menu-link px-3">
                                Generate Bill
                            </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3" data-kt-menu-trigger="hover" data-kt-menu-placement="right-end">
                            <a href="#" class="menu-link px-3">
                                <span class="menu-title">Subscription</span>
                                <span class="menu-arrow"></span>
                            </a>

                            <!--begin::Menu sub-->
                            <div class="menu-sub menu-sub-dropdown w-175px py-4">
                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Plans
                                    </a>
                                </div>
                                <!--end::Menu item-->
                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Billing
                                    </a>
                                </div>
                                <!--end::Menu item-->
                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <a href="#" class="menu-link px-3">
                                        Statements
                                    </a>
                                </div>
                                <!--end::Menu item-->
                                <!--begin::Menu separator-->
                                <div class="separator my-2"></div>
                                <!--end::Menu separator-->
                                <!--begin::Menu item-->
                                <div class="menu-item px-3">
                                    <div class="menu-content px-3">
                                        <!--begin::Switch-->
                                        <label class="form-check form-switch form-check-custom form-check-solid">
                                            <!--begin::Input-->
                                            <input class="form-check-input w-30px h-20px" type="checkbox" value="1" checked="checked" name="notifications">
                                            <!--end::Input-->
                                            <!--end::Label-->
                                            <span class="form-check-label text-muted fs-6">
                                                Recuring
                                            </span>
                                            <!--end::Label-->
                                        </label>
                                        <!--end::Switch-->
                                    </div>
                                </div>
                                <!--end::Menu item-->
                            </div>
                            <!--end::Menu sub-->
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3 my-1">
                            <a href="#" class="menu-link px-3">
                                Settings
                            </a>
                        </div>
                        <!--end::Menu item-->
                    </div>
                    <!--end::Menu 3-->
                    *@
                    <!--end::Menu-->
                </div>
            </div>
            <!--end::Header-->
            <!--begin::Body-->
            <div class="card-body py-3">
                @{
                    if (Model.InventoryItems.Count > 0)
                    {
                        <!--begin::Table container-->
                        <div class="table-responsive">
                            <!--begin::Table-->
                            <table class="table align-middle table-row-dashed fs-6 gs-3 gy-3">
                                <!--begin::Table head-->
                                <thead>
                                    <tr class="fw-bolder fs-7 gs-0">
                                        <th class="p-0">code</th>
                                        <th class="p-0">Item</th>
                                        <th class="p-0">Quantity Available</th>
                                        <th class="p-0">Status</th>
                                    </tr>
                                </thead>
                                <!--end::Table head-->
                                <!--begin::Table body-->
                                <tbody>
                                    @{
                                        foreach (var item in Model.InventoryItems)
                                        {
                                            <tr>
                                                <td>
                                                    @{
                                                        if (Model.ModulePermission.Configure)
                                                        {
                                                            <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.Id">
                                                                <div class="fw-semibold text-primary badge badge-light-primary p-2">@item.Item?.ItemCode</div>
                                                            </a>
                                                        }
                                                        else
                                                        {
                                                            <div class="fw-semibold text-primary badge badge-light-primary p-2">@item.Item?.ItemCode</div>
                                                        }
                                                    }
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="me-5 position-relative">
                                                            @{
                                                                if (Model.ModulePermission.Configure)
                                                                {
                                                                    <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.Id">
                                                                        <div class="symbol symbol-35px symbol-circle">
                                                                            <img alt="@item.Item?.ItemName" src="@Url.Content(item.Item?.ItemPhotoPath)">
                                                                        </div>
                                                                    </a>
                                                                }
                                                                else
                                                                {
                                                                    <div class="symbol symbol-35px symbol-circle">
                                                                        <img alt="@item.Item?.ItemName" src="@Url.Content(item.Item?.ItemPhotoPath)">
                                                                    </div>
                                                                }
                                                            }
                                                        </div>
                                                        <div class="d-flex flex-column justify-content-center">
                                                            @{
                                                                if (Model.ModulePermission.Configure)
                                                                {
                                                                    <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.Id" class="text-gray-800 text-hover-primary mb-1">@item.Item?.ItemName</a>
                                                                }
                                                                else
                                                                {
                                                                    <a href="#" class="text-gray-800 text-hover-secondary mb-1">@item.Item?.ItemName</a>
                                                                }
                                                            }
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="fw-bold">@item.Quantity</td>
                                                <td class="">
                                                    @{
                                                        @await Html.PartialAsync("Inventory/_InventoryStatus", item.Status)
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                                <!--end::Table body-->
                            </table>
                            <!--end::Table-->
                        </div>
                        <!--end::Table container-->
                    }
                }
            </div>
            <!--begin::Body-->
        </div>
        <!--end::Tables Widget 3-->
    </div>
    <!--end::Col-->
    <!--begin::Col-->
    <div class="col-xl-6">

        <!--begin::Tables Widget 4-->
        <div class="card card-xl-stretch mb-5 mb-xl-8">
            <!--begin::Header-->
            <div class="card-header border-0 pt-5">
                <h3 class="card-title align-items-start flex-column">
                    <span class="card-label fw-bold fs-3 mb-1">Top 20 Most Requested Items</span>

                    <span class="text-gray-700 mt-1 fw-semibold fs-7">Most requested items</span>
                </h3>
                <div class="card-toolbar">
                </div>
            </div>
            <!--end::Header-->
             <!--begin::Body-->
            <div class="card-body py-3">
                @{
                    if (Model.RequestedItems.Count > 0)
                    {
                        <!--begin::Table container-->
                        <div class="table-responsive">
                            <!--begin::Table-->
                            <table class="table align-middle table-row-dashed fs-6 gs-3 gy-3">
                                <!--begin::Table head-->
                                <thead>
                                    <tr class="fw-bolder fs-7 gs-0">
                                        <th class="p-0">code</th>
                                        <th class="p-0">Item</th>
                                        <th class="p-0">Quantity Requested</th>
                                    </tr>
                                </thead>
                                <!--end::Table head-->
                                <!--begin::Table body-->
                                <tbody>
                                    @{
                                        foreach (var item in Model.RequestedItems)
                                        {
                                            <tr>
                                                <td>
                                                    @{
                                                        if (Model.ModulePermission.Configure)
                                                        {
                                                            <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.RequestItem?.Item?.Id">
                                                                <div class="fw-semibold text-primary badge badge-light-primary p-2">@item.RequestItem?.Item?.ItemCode</div>
                                                            </a>
                                                        }
                                                        else
                                                        {
                                                            <div class="fw-semibold text-primary badge badge-light-primary p-2">@item.RequestItem?.Item?.ItemCode</div>
                                                        }
                                                    }
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="me-5 position-relative">
                                                            @{
                                                                if (Model.ModulePermission.Configure)
                                                                {
                                                                    <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.RequestItem?.Item?.Id">
                                                                        <div class="symbol symbol-35px symbol-circle">
                                                                            <img alt="@item.RequestItem?.Item?.ItemName" src="@Url.Content(item.RequestItem?.Item?.ItemPhotoPath)">
                                                                        </div>
                                                                    </a>
                                                                }
                                                                else
                                                                {
                                                                    <div class="symbol symbol-35px symbol-circle">
                                                                        <img alt="@item.RequestItem?.Item?.ItemName" src="@Url.Content(item.RequestItem?.Item?.ItemPhotoPath)">
                                                                    </div>
                                                                }
                                                            }
                                                        </div>
                                                        <div class="d-flex flex-column justify-content-center">
                                                            @{
                                                                if (Model.ModulePermission.Configure)
                                                                {
                                                                    <a asp-controller="Facility" asp-action="UpdateItem" asp-route-id="@item.RequestItem?.Item?.Id" class="text-gray-800 text-hover-primary mb-1">@item.RequestItem?.Item?.ItemName</a>
                                                                }
                                                                else
                                                                {
                                                                    <a href="#" class="text-gray-800 text-hover-secondary mb-1">@item.RequestItem?.Item?.ItemName</a>
                                                                }
                                                            }
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="fw-bold">@item.TotalRequested</td>                                                
                                            </tr>
                                        }
                                    }
                                </tbody>
                                <!--end::Table body-->
                            </table>
                            <!--end::Table-->
                        </div>
                        <!--end::Table container-->
                    }
                }
            </div>
            <!--begin::Body-->
        </div>
        <!--end::Tables Widget 4-->
    </div>
    <!--end::Col-->
</div>

@*

<div class="row mt-4">
    <div class="col-12 col-sm-6 col-lg-6 col-xl-3">
        <div class="card gradient-scooter">
            <a asp-action="Requests" asp-controller="Facility">
                <div class="card-body p-4">

                    <div class="media">
                        <div class="media-body text-left">
                            <h4 class="text-white">@Model.RequestsCount</h4>
                            <span class="text-white">Total Request(s)</span>
                        </div>
                        <div class="align-self-center w-icon"><i class="icon-note text-white"></i></div>
                    </div>

                </div>
            </a>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-6 col-xl-3">
        <div class="card gradient-bloody">
            <a asp-action="Items" asp-controller="Facility">
                <div class="card-body p-4">

                    <div class="media">
                        <div class="media-body text-left">
                            <h4 class="text-white">@Model.ItemsCount</h4>
                            <span class="text-white">Total Item(s)</span>
                        </div>
                        <div class="align-self-center w-icon"><i class="icon-bag text-white"></i></div>
                    </div>

                </div>

            </a>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-6 col-xl-3">
        <div class="card gradient-quepal">
            <a asp-action="Inventory" asp-controller="Facility">
                <div class="card-body p-4">

                    <div class="media">
                        <div class="media-body text-left">
                            <h4 class="text-white">@Model.InventoryCount</h4>
                            <span class="text-white">Total Inventory</span>
                        </div>
                        <div class="align-self-center w-icon"><i class="icon-basket-loaded text-white"></i></div>
                    </div>

                </div>
            </a>
        </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-6 col-xl-3">
        <div class="card gradient-blooker">
            <a asp-action="Users" asp-controller="Account">
                <div class="card-body p-4">

                    <div class="media">
                        <div class="media-body text-left">
                            <h4 class="text-white">@Model.UsersCount</h4>
                            <span class="text-white">New User(s)</span>
                        </div>
                        <div class="align-self-center w-icon"><i class="icon-people text-white"></i></div>
                    </div>

                </div>
            </a>
        </div>
    </div>
</div>



    <div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <h4 style="text-align:center;vertical-align:central;">Recent Requests</h4>
                <div class="card-action">
                </div>
            </div>
            <div class="card-body py-4">
                <div class="table-responsive">
                    <table class="table align-middle table-row-dashed fs-6 gy-5 gs-5">
                        @{
                            if (Model.Requests.Count > 0)
                            {
                                <thead>
                                    <tr class="text-start text-muted fw-bolder fs-7 text-uppercase gs-0">
                                        <th>Reference</th>
                                        <th>Total Items</th>
                                        <th>Purpose</th>
                                        <th>Requested By</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody class="text-gray-600 fw-bold">
                                    @foreach (var request in Model.Requests)
                                    {
                                        <tr>
                                            <td><a asp-action="RequestDetails" asp-controller="Facility" asp-route-id="@request.Id" class="badge badge-light-primary fs-5 fw-bolder px-3 py-3">@request.RequestCode</a></td>
                                            <td>@request.RequestItems?.Count</td>
                                            <td>@request.Purpose</td>
                                            <td>@request.RequestedBy?.FullName</td>
                                            <td>@await Html.PartialAsync("Inventory/_RequestStatus", request.Status)</td>
                                            <td>@Html.DisplayFor(modelItem => request.RequestDate)</td>
                                        </tr>
                                    }
                                </tbody>
                            }
                            else
                            {
                                <p>No Request items Requested yet</p>
                            }
                        }
                    </table>
                </div>
            </div>
        </div>
    </div>
</div> 

*@

<!--End Row-->
<!--End Dashboard Content-->
<!-- End container-fluid-->

<div id="divDashboard" class="">
</div>

@section Scripts {
    @*
    <script src="~/Dashboard/assets/js/jquery.min.js"></script>
    <script src="~/Dashboard/assets/js/bootstrap.min.js"></script>
    <script src="~/Dashboard/assets/js/popper.min.js"></script>
    <!-- simplebar js -->
    <script src="~/Dashboard/assets/plugins/simplebar/js/simplebar.js"></script>
    <!-- waves effect js -->
    <script src="~/Dashboard/assets/js/waves.js"></script>
    <!-- sidebar-menu js -->
    <script src="~/Dashboard/assets/js/sidebar-menu.js"></script>
    <!-- Custom scripts -->
    <script src="~/Dashboard/assets/js/app-script.js"></script>
    <!-- Vector map JavaScript -->
    <script src="~/Dashboard/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="~/Dashboard/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js"></script>
    <!-- Sparkline JS -->
    <script src="~/Dashboard/assets/plugins/sparkline-charts/jquery.sparkline.min.js"></script>
    <!-- Chart js -->
    <script src="~/Dashboard/assets/plugins/Chart.js/Chart.min.js"></script>
    <!--notification js -->
    <script src="~/Dashboard/assets/plugins/notifications/js/lobibox.min.js"></script>
    <script src="~/Dashboard/assets/plugins/notifications/js/notifications.min.js"></script>
    <!-- Index js -->
    <script src="~/Dashboard/assets/js/index.js"></script>
   *@


    <script>

        document.addEventListener('DOMContentLoaded', function () {

            $('.types-select').select2({
                width: 'resolve',
                placeholder: 'Select an Option',
                allowClear: true
            });

            $('.flatPickr_Date').flatpickr({
                altInput: true,
                altFormat: "Y", // Display only the year in the alternate input field
                dateFormat: "Y", // Display only the year in the popup calendar
                defaultDate: "today", // Highlight today's date
                mode: "single", // Ensure only the year is selectable
                minDate: "1900", // Set a minimum selectable year if needed
                maxDate: "2100", // Set a maximum selectable year if needed
            });

            //GetDashboard();

        });

        function GetDashboard() {
            var yearSelector = document.getElementById("yearSelect");
            var activeYear = yearSelector.value;
            console.log(activeYear);
            if (activeYear) {
                $.ajax({
                    type: 'GET',
                    cache: false,
                    url: '@Url.Action("GetDashboard", "Occurrence")',
                    contentType: 'application/json;',
                    data: { selectedYear: activeYear },
                    success: function (response) {
                        $("#divDashboard").html(response);
                        PlotOccurrenceTypePieChart(activeYear);
                        PlotOccurrenceCategoryPieChart(activeYear);

                    },
                    error: function (er) {
                        alert(er);
                    }
                });
            }
            else {
                $("#divDashboard").html("");
            }
        }

        //Pie Chart A
        function PlotOccurrenceTypePieChart(selectedValue) {
            if (selectedValue) {
                $.ajax({
                    type: 'GET',
                    url: "@Url.Action("GetOccurrenceTypesPieData", "Occurrence")",
                    contentType: 'application/json',
                    data: { selectedYear: selectedValue },
                    success: function (result) {
                        $('#chartA').html("");
                        //console.log(result);

                        //Plot Chart
                        var data = result;
                        // var data = [
                        //     { MemberPledge: { Pledge: { PledgeName: "Pledge 1" } }, TotalPledgeAmount: 100, PledgeCount: 5 },
                        //     { MemberPledge: { Pledge: { PledgeName: "Pledge 2" } }, TotalPledgeAmount: 200, PledgeCount: 3 },
                        //     // Add more data here
                        // ];

                        //Extracting labels and values from the data
                        var labels = data.map(item => item.OccurrenceType);
                        var values = data.map(item => item.TotalOccurrences);

                        // Creating the chart
                        var options = {
                            chart: {
                                type: 'pie',
                                width: '100%',
                                toolbar: {
                                    show: true,
                                    tools: {
                                        download: true,
                                        selection: true,
                                        zoom: true,
                                        zoomin: true,
                                        zoomout: true,
                                        pan: true,
                                        reset: true
                                    }
                                }
                            },
                            series: values,
                            labels: labels,
                            // responsive: [{
                            //     breakpoint: 480,
                            //     options: {
                            //         chart: {
                            //             width: 300
                            //         },
                            //         legend: {
                            //             position: 'bottom'
                            //         }
                            //     }
                            // }]
                        };

                        var chart = new ApexCharts(document.querySelector("#chartA"), options);
                        chart.render();
                    },
                    error: function (er) {
                        alert(er);
                    }
                });
            }
        }

        //Pie Chart B
        function PlotOccurrenceCategoryPieChart(selectedValue) {
            if (selectedValue) {
                $.ajax({
                    type: 'GET',
                    url: "@Url.Action("GetOccurrenceCategoryPieData", "Occurrence")",
                    contentType: 'application/json',
                    data: { selectedYear: selectedValue },
                    success: function (result) {
                        $('#chartB').html("");
                        //console.log(result);

                        //Plot Chart
                        var data = result;
                        // var data = [
                        //     { MemberPledge: { Pledge: { PledgeName: "Pledge 1" } }, TotalPledgeAmount: 100, PledgeCount: 5 },
                        //     { MemberPledge: { Pledge: { PledgeName: "Pledge 2" } }, TotalPledgeAmount: 200, PledgeCount: 3 },
                        //     // Add more data here
                        // ];

                        //Extracting labels and values from the data
                        var labels = data.map(item => item.OccurrenceCategory);
                        var values = data.map(item => item.TotalOccurrences);

                        // Creating the chart
                        var options = {
                            chart: {
                                type: 'pie',
                                width: '100%',
                                toolbar: {
                                    show: true,
                                    tools: {
                                        download: true,
                                        selection: true,
                                        zoom: true,
                                        zoomin: true,
                                        zoomout: true,
                                        pan: true,
                                        reset: true
                                    }
                                }
                            },
                            series: values,
                            labels: labels,
                            // theme: {
                            //     monochrome: {
                            //         enabled: true
                            //     }
                            // },
                            // legend: {
                            //     position: 'bottom'
                            // },
                            legend: {
                                position: 'right',
                                offsetY: 0,
                                offsetX: 5,
                                //height: 230,
                            },
                        };

                        var chart = new ApexCharts(document.querySelector("#chartB"), options);
                        chart.render();
                    },
                    error: function (er) {
                        alert(er);
                    }
                });
            }
        }

    </script>
}

