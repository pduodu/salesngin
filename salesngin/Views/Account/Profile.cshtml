@model UserViewModel
@inject SignInManager<ApplicationUser> _signInManager
@inject UserManager<ApplicationUser> _userManager
@inject IDataControllerService _dataService
@{
    ViewData["Title"] = "Profile";
    ViewData["MainMenu"] = "User Management";
    //ViewData["SubMenu"] = "Users";
    ViewData["Page"] = "Profile";
}

<div class="d-flex flex-column flex-xl-row">
    <!--begin::Sidebar-->
    <div class="flex-column flex-lg-row-auto w-100 w-xl-300px mb-10">
        <!--begin::Card-->
        <div class="card mb-5 mb-xl-8" data-kt-sticky="true">
            <!--begin::Card body-->
            <div class="card-body">
                <!--begin::Summary-->
                <!--begin::User Info-->
                <div class="d-flex flex-center flex-column py-5">
                    <!--begin::Avatar-->
                    <div class="symbol symbol-150px symbol-circle mb-7">
                        <img src="@Url.Content(Model.User?.UserPhotoPath)" alt="@Model.User?.UserInitials" />
                    </div>
                    <!--end::Avatar-->
                    <!--begin::Name-->
                    <a href="#" class="fs-3 text-gray-800 text-hover-primary fw-bolder mb-3">@Model.User?.FullName</a>
                    <!--end::Name-->
                    <!--begin::Position-->
                    <div class="mb-9">
                        <!--begin::Badge-->
                        <div class="badge badge-lg badge-light-primary d-inline">Role : @Model.UserRole?.RoleDisplayText</div>
                        <!--begin::Badge-->
                    </div>
                    <!--end::Position-->
                    <div class="mb-9">
                        @{
                            var statusParameters = new { UserId = @Model.User?.Id, UserStatus = Model.User?.IsActive, ModulePermission = Model.ModulePermission };
                            @await Html.PartialAsync("User/_UserAccountStatus", statusParameters)
                        }
                    </div>
                </div>
                <!--end::User Info-->
                <!--end::Summary-->
                <!--begin::Details toggle-->
                <div class="d-flex flex-stack fs-4 pb-3">
                    <div class="fw-bolder rotate collapsible" data-bs-toggle="collapse" href="#kt_user_view_details" role="button" aria-expanded="false" aria-controls="kt_user_view_details">
                        Details
                        <span class="ms-2 rotate-180">
                            <!--begin::Svg Icon | path: icons/duotune/arrows/arr072.svg-->
                            <span class="svg-icon svg-icon-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <path d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z" fill="currentColor" />
                                </svg>
                            </span>
                            <!--end::Svg Icon-->
                        </span>
                    </div>
                    @*  <span data-bs-toggle="tooltip" data-bs-trigger="hover" title="Edit customer details">
                    <a href="#" class="btn btn-sm btn-light-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_update_details">Edit</a>
                    </span>*@
                </div>
                <!--end::Details toggle-->
                <div class="separator"></div>
                <!--begin::Details content-->
                <div id="kt_user_view_details" class="collapse show">
                    <div class="pb-5 fs-6">
                        @{
                            if (Model.Employee != null)
                            {
                                <div class="fw-bolder mt-5">Employee Type</div>
                                <div class="badge badge-lg badge-light-primary mt-5">@Model.Employee?.EmployeeType?.Name</div>
                                <div class="fw-bolder mt-5">Staff ID</div>
                                <div class="text-gray-600">@Model.Employee?.StaffNumber</div>
                            }
                        }
                        <div class="fw-bolder mt-5">Email</div>
                        <div class="text-gray-600">
                            <a href="#" class="text-gray-600 text-hover-primary">@Model.User?.Email</a>
                        </div>
                        <div class="fw-bolder mt-5">Address</div>
                        <div class="text-gray-600">
                            @Model.User?.PostalAddress
                            <div class="fw-bolder mt-5">Country</div>
                            <div class="text-gray-600">@Model.Country?.CountryName</div>
                            <div class="fw-bolder mt-5">Last Login</div>
                            <div class="text-gray-600">@Html.DisplayFor(m => Model.User.LastLogin)</div>
                        </div>
                        @* @{
                            if (Model.SmsRoles.Count > 0)
                            {
                                <div class="fw-bolder mt-5">SMS Responsibilities</div>
                                <div>
                                    @foreach (var role in Model.SmsRoles)
                                    {
                                        <div class="badge badge-lg badge-light-primary mt-2 mx-2">@role?.RoleDisplayText</div>
                                    }
                                </div>

                            }
                        } *@
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-lg-row-fluid ms-lg-10">
        <!--begin:::Tabs-->
        <ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-bold mb-8">
            <!--begin:::Tab item-->
            <li class="nav-item">
                <a class="nav-link text-active-primary pb-4 active" data-bs-toggle="tab" href="#user_overview">Overview</a>
            </li>
            <!--end:::Tab item-->
            @{
                //if (await _dataService.GetModuleActionPermission(ConstantModules.User_Module, Model.UserLoggedIn.Id, ConstantPermissions.Configure))
                if (Model.ModulePermission.Update)
                {
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4" data-bs-toggle="tab" href="#user_corporate">Corporate </a>
                    </li>
                    <!--end:::Tab item-->
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4" data-bs-toggle="tab" href="#user_personal">Personal</a>
                    </li>
                    <!--end:::Tab item-->
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4" data-bs-toggle="tab" href="#user_photoPassword">Photo & Password</a>
                    </li>
                    <!--end:::Tab item-->
                    <!--begin:::Tab item-->
                    <li class="nav-item">
                        <a class="nav-link text-active-primary pb-4" data-bs-toggle="tab" href="#user_RolePermission">Roles & Permission</a>
                    </li>
                    <!--end:::Tab item-->
                }
            }
        </ul>
        <!--end:::Tabs-->
        <!--begin:::Tab content-->
        <div class="tab-content pt-4" id="myTabContent">
            <!--begin:::Tab pane-->
            <div class="tab-pane fade active show" id="user_overview" role="tabpanel">
                <div class="row row-cols-1 row-cols-md-2 mb-6 mb-xl-9">
                    <div class="col">
                        <!--begin::Card-->
                        <div class="card pt-4 h-md-100 mb-6 mb-md-0">
                            <!--begin::Card header-->
                            <div class="card-header border-0">
                                <!--begin::Card title-->
                                <div class="card-title">
                                    <h2 class="fw-bold">Reward Points</h2>
                                </div>
                                <!--end::Card title-->
                            </div>
                            <!--end::Card header-->
                            <!--begin::Card body-->
                            <div class="card-body pt-0">
                                <div class="fw-bold fs-2">
                                    <div class="d-flex">
                                        <!--begin::Svg Icon | path: icons/duotune/general/gen030.svg-->
                                        <span class="svg-icon svg-icon-info svg-icon-2x">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M18.3721 4.65439C17.6415 4.23815 16.8052 4 15.9142 4C14.3444 4 12.9339 4.73924 12.003 5.89633C11.0657 4.73913 9.66 4 8.08626 4C7.19611 4 6.35789 4.23746 5.62804 4.65439C4.06148 5.54462 3 7.26056 3 9.24232C3 9.81001 3.08941 10.3491 3.25153 10.8593C4.12155 14.9013 9.69287 20 12.0034 20C14.2502 20 19.875 14.9013 20.7488 10.8593C20.9109 10.3491 21 9.81001 21 9.24232C21.0007 7.26056 19.9383 5.54462 18.3721 4.65439Z" fill="currentColor"></path>
                                            </svg>
                                        </span>
                                        <!--end::Svg Icon-->
                                        <div class="ms-2">
                                            4,571
                                            <span class="text-muted fs-4 fw-bold">Points earned</span>
                                        </div>
                                    </div>
                                    <div class="fs-7 fw-normal text-muted">Earn reward points with every purchase.</div>
                                </div>
                            </div>
                            <!--end::Card body-->
                        </div>
                        <!--end::Card-->
                    </div>
                    <div class="col">
                        <!--begin::Reward Tier-->
                        <a href="#" class="card bg-info hoverable h-md-100">
                            <!--begin::Body-->
                            <div class="card-body">
                                <!--begin::Svg Icon | path: icons/duotune/general/gen020.svg-->
                                <span class="svg-icon svg-icon-white svg-icon-3x ms-n1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path d="M14 18V16H10V18L9 20H15L14 18Z" fill="currentColor"></path>
                                        <path opacity="0.3" d="M20 4H17V3C17 2.4 16.6 2 16 2H8C7.4 2 7 2.4 7 3V4H4C3.4 4 3 4.4 3 5V9C3 11.2 4.8 13 7 13C8.2 14.2 8.8 14.8 10 16H14C15.2 14.8 15.8 14.2 17 13C19.2 13 21 11.2 21 9V5C21 4.4 20.6 4 20 4ZM5 9V6H7V11C5.9 11 5 10.1 5 9ZM19 9C19 10.1 18.1 11 17 11V6H19V9ZM17 21V22H7V21C7 20.4 7.4 20 8 20H16C16.6 20 17 20.4 17 21ZM10 9C9.4 9 9 8.6 9 8V5C9 4.4 9.4 4 10 4C10.6 4 11 4.4 11 5V8C11 8.6 10.6 9 10 9ZM10 13C9.4 13 9 12.6 9 12V11C9 10.4 9.4 10 10 10C10.6 10 11 10.4 11 11V12C11 12.6 10.6 13 10 13Z" fill="currentColor"></path>
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <div class="text-white fw-bold fs-2 mt-5">Premium Member</div>
                                <div class="fw-bold text-white">Tier Milestone Reached</div>
                            </div>
                            <!--end::Body-->
                        </a>
                        <!--end::Reward Tier-->
                    </div>
                </div>
                <!--begin::Card-->
                <div class="card pt-4 mb-6 mb-xl-9">
                    <!--begin::Card header-->
                    <div class="card-header border-0">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>Transaction History</h2>
                        </div>
                        <!--end::Card title-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body pt-0 pb-5">
                        <!--begin::Table-->
                        <!--end::Table-->
                    </div>
                    <!--end::Card body-->
                </div>
                <!--end::Card-->
            </div>
            <!--end:::Tab pane-->
            @{
                //User must have access to configure
                if (Model.ModulePermission.Configure)
                {
                    <!--begin:::Tab pane-->
                    <div class="tab-pane fade" id="user_corporate" role="tabpanel">
                        <!--begin::Card-->
                        @await Html.PartialAsync("_UserCorporate", Model)
                        <!--end::Card-->
                    </div>
                    <!--end:::Tab pane-->
                    <!--begin:::Tab pane-->
                    <div class="tab-pane fade" id="user_personal" role="tabpanel">
                        <!--begin::Card-->
                        @await Html.PartialAsync("_UserPersonal", Model)
                        <!--end::Card-->
                    </div>
                    <!--end:::Tab pane-->
                    <!--begin:::Tab pane-->
                    <div class="tab-pane fade" id="user_photoPassword" role="tabpanel">
                        <!--begin::Card-->
                        <div class="row">
                            <div class="col">
                                @await Html.PartialAsync("_UserPhoto", Model)
                            </div>
                            <div class="col">
                                @await Html.PartialAsync("_UserPasswordUpdate", Model)
                            </div>
                        </div>
                        <!--end::Card-->
                    </div>
                    <!--end:::Tab pane-->
                    <!--begin:::Tab pane-->
                    <div class="tab-pane fade" id="user_RolePermission" role="tabpanel">
                        <!--begin::Card-->
                        @await Html.PartialAsync("_UserRoleInput", Model)
                        <div id="divModulePermissions" class="card-body">
                            @await Html.PartialAsync("_UserPermissionsInput", Model)
                        </div>
                    </div>
                    <!--end:::Tab pane-->
                    @* <div class="col-md-12">
            @await Html.PartialAsync("_UserContactInput", Model)
            @await Html.PartialAsync("_UserSecurityInput", Model)
            </div> *@
                }
            }



        </div>
        <!--end:::Tab content-->
    </div>
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            //$('#kt_datepicker_1').datepicker();
            // $('.flatPickr_Date').flatpickr({
            //     //dateFormat:"dd-mm-yyyy"
            //     //format:"d-m-Y",
            //     altInput: true,
            //     altFormat: "j F, Y",
            //     //dateFormat: "Y-m-d",
            //     dateFormat: "d-m-Y",
            //     //dateFormat: "DD-MM-YYYY",
            // });

            $('.flatPickr_Date').flatpickr({
                altInput: true,
                altFormat: "j F, Y",
                dateFormat: "Y-m-d",
            });

            registerCheckStatus();

        });

        //hold check box vlaue form base
        function registerCheckStatus() {
            var elements = document.getElementsByClassName("chkPer");
            for (var i = 0, len = elements.length; i < len; i++) {
                // elements[i].style ...
                if (elements[i].checked) {
                    $(elements[i]).attr("value", "true");
                } else {
                    $(elements[i]).attr("value", "false");
                }
            }
        }

        function getStaffId(id) {

            let radioElement = document.getElementById("employeeTypeId_" + id);
            var name = radioElement.getAttribute('data-arg1')
            let companyElement = document.getElementById("divCompany");
            let unitElement = document.getElementById("divUnit");
            let employeeIdElement = $("#hdEmployeeId");

            let tempEmp = 'Temporal';
            companyElement.style.display = name === tempEmp ? 'block' : 'none';
            unitElement.style.display = name === tempEmp ? 'none' : 'block';

            var empId = employeeIdElement.val();

            var data = { id: id, eid: empId };

            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetStaffNumber", "Account")',
                contentType: 'application/json; charset=utf=8',
                data: data,
                success: function (result) {
                    $('#StaffNumber').val(result);
                },
                error: function (er) {
                    alert(er);
                }
            });

        }

        function GetPermissions(id, uid) {
            if (id == "" || uid == "") {
                $("#divModulePermissions").empty();
            }
            else {
                //var uid = $("#UserId_role").val();
                var data = { id: id, uid: uid };
                $.ajax({
                    type: 'GET',
                    cache: false,
                    url: '@Url.Action("GetUserPermissions", "Account")',
                    data: data,
                    success: function (response) {
                        $("#divModulePermissions").empty();
                        $("#divModulePermissions").html(response);
                    }
                });
            }
        }



    </script>
}